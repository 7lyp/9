<!-- by 梁梅 -->

# CatraMMS 人脸识别功能使用教程

# 一、数据准备阶段  
1. 参考数据入库  
   操作目的：建立人脸特征比对库。  
   步骤说明：  
     1. 通过媒体管理接口上传参考人脸图像或视频片段至媒体库。 
     ![](2025-05-12-16-11-21.png)
     ![](2025-05-12-16-11-43.png)
     2. 系统返回该数据的唯一标识符 `medialtemKey`（例如 `11`）。
      ![](2025-05-12-16-11-58.png)
     3. 在元数据中标注 `deepLearnedModelTags`（如身份标签 `GIULIANO`），与预训练深度学习模型关联。  

2. 输入流注册  
   -操作目的：定义待识别视频源。  
   步骤说明：  
     1. 注册目标视频流或文件至系统，获取其 `configurationLabel`（如 `conf-video-45`）。  
     2. 验证流协议兼容性（支持 RTMP、HLS、HTTP-FLV 等）。  

# 二、任务配置阶段  
写个任务单子：
   ![](2025-05-12-16-12-09.png)

# 三、任务提交与执行阶段  
1. API 任务提交  
   操作目的：触发异步处理流水线。  
   步骤说明：  
     1. 调用 `POST /api/tasks`接口提交任务配置文件。  
     2. 系统返回`encodingJobKey`（如 `789`）用于状态追踪。   

2. 任务队列调度  
   系统行为：  
     1. 任务进入分布式任务队列，由负载均衡模块分配至可用计算节点。  
     2. 节点加载预训练模型（如 FaceNet、ResNet）及级联分类器文件（`.xml`）。  


# CatraMMS 人脸身份识别功能使用教程

# 一、数据准备与注册  
1. 参考数据入库  
   操作目的：构建身份特征库以实现精准匹配。  
   步骤说明：  
     1. 通过媒体管理接口上传目标身份的人脸图像或视频片段至媒体库。  
     2. 系统返回该数据的唯一标识符 `medialtemKey`。  
     3. 在元数据中绑定`deepLearnedModelTags`（如身份标签 `Employee_001`），与预训练的深度学习模型（如 FaceNet、ArcFace）关联。  

2. 输入流/文件注册  
   操作目的：定义待识别的视频源或实时流。  
   步骤说明：  
     1. 注册目标视频流（如 RTMP、HLS）或文件至系统，获取其 `configurationLabel`（如 `conf-video-45`）。  
     2. 验证流协议兼容性及稳定性（支持断线重连与动态缓冲）。  

# 二、任务提交与执行  
1. 通过 API 提交任务  
   操作目的：触发异步处理流水线。  
   步骤说明：  
     1. 调用 `POST /api/tasks` 接口提交任务配置文件。  
     2. 系统返回 `encodingJobKey`（如 `789`）用于状态追踪及后续操作。  

2. 分布式任务调度  
   系统行为：  
     1. 任务进入优先级任务队列，由调度引擎分配至可用计算节点。  
     2. 节点加载预训练模型（如 ResNet-100）及级联分类器文件（`.xml`）。  
     3. 初始化 GPU 加速上下文（若配置 CUDA）。  

# 三、核心处理流程  
1. 人脸检测（Face Detection）  
   技术实现：  
     使用 Haar/LBP 级联分类器逐帧执行多尺度滑动窗口检测。  
    
2. 结果生成与持久化  
   输出类型：  
     可视化视频：在检测区域叠加边界框（Bounding Box）、身份标签及置信度（如 `Employee_001, 92.5%`）。  
     结构化元数据：生成 JSON 文件，记录时间戳、坐标、标签、置信度及匹配状态。  
     
# CatraMMS 直播网格功能使用教程

# 一、输入流准备与注册  
1. 定义输入流源  
   操作目的：明确待合成的多路直播流源及其技术参数。  
   步骤说明：  
     1. 通过流管理接口注册每路直播流，记录其协议（RTMP、SRT、HLS）、分辨率、帧率及编解码格式。  
     2. 为每路流分配唯一`configurationLabel`（如 `conf-stream-1`、`conf-stream-2`）。  
     3. 验证输入流的稳定性（缓冲策略、重连机制）及协议兼容性。  

2. 编码预设配置  
   操作目的：定义输出流的编码参数以平衡质量与带宽。  

# 二、任务提交与执行  
1. API 任务提交  
   操作目的：触发分布式合成流水线。  
   步骤说明：  
     1. 调用 `POST /api/tasks`接口提交任务配置文件。  
     2. 系统返回 `encodingJobKey`（如 `789`）及初始状态（`queued` 或 `running`）。  
   
2. 任务调度与资源分配  
   系统行为：  
     1. 任务进入优先级任务队列，由调度引擎分配至负载最低的计算节点。  
     2. 节点初始化 FFmpeg 实例，加载输入流并绑定滤镜链（`xstack` 或 `grid` 滤镜）。  
     3. 按配置参数动态合成网格布局，启用硬件加速（如 NVIDIA NVENC 或 Intel QSV）。  

# 三、核心处理流程  
1. 流输入与解码  
   技术实现：  
     通过 FFmpeg 的 `libavformat` 解复用输入流，提取音视频裸数据。  
     支持动态缓冲（Jitter Buffer）以应对网络抖动，确保流同步。  

2. 网格布局合成  
   滤镜链配置：  
     使用 `scale` 滤镜统一子画面分辨率（如 960x540）。  
     通过 `xstack` 滤镜定义布局（例如 `layout=0_0|w0_0` 表示水平排列）。  
   
3. 编码与推流  
   技术实现：  
     调用预设编码器（如 `h264_nvenc`）压缩合成后的视频流。  
     通过 `librtmp` 或 `libsrt` 推送至目标 CDN 或媒体服务器。  

# CatraMMS 直播录制功能使用教程

# 一、输入流配置与注册 
1. 直播流定义与协议验证  
   操作目的：确保待录制流源的稳定性与兼容性。  
   步骤说明：  
     1. 通过流管理接口注册直播流，指定协议（如 RTMP、HLS、SRT）、分辨率、帧率及编码格式（H.264/H.265）。  
     2. 分配唯一标识符`configurationLabel`（如 `conf-live-1`），用于后续任务绑定。  
     3. 验证输入流连通性，配置动态缓冲策略（Jitter Buffer）以应对网络抖动。  

2. 存储路径规划  
   操作目的：定义录制文件的持久化存储位置及保留策略。  
   步骤说明：  
     1. 在 `predefinedEncodingProfiles/storage.json` 中配置本地存储路径（如 `/mnt/recordings/`）或云存储端点（如 AWS S3、阿里云 OSS）。  
     2. 设置文件保留周期（如 `retentionDays: 30`）及自动清理规则（LRU 或时间触发）。  

# 二、任务参数配置与初始化  
1. JSON 任务配置文件定义    
  ![](2025-05-12-16-12-24.png)

# 三、任务提交与自动化执行  
1. API 任务提交  
   操作目的：触发录制流水线并分配资源。  
   步骤说明：  
     1. 调用`POST /api/tasks`接口提交任务配置文件，系统返回`encodingJobKey`（如 `789`）。  
     2. 任务进入分布式任务队列，由调度引擎分配至最优计算节点。  

2. 实时流处理与录制  
   技术实现：  
     1. 初始化 FFmpeg 实例，通过 `libavformat` 解复用输入流，提取音视频数据包。  
     2. 按配置分段规则（时间或大小）生成独立文件，写入指定存储路径。  
     3. 动态处理输入流中断：  
        重连机制：最大重试次数（默认5次），超时阈值（如10秒）。  
        断点续录：记录最后有效时间戳，恢复后自动衔接录制。  

# 四、任务监控与状态管理  
1. 实时状态查询  
   响应内容：  
     `status`：任务状态（`running`、`paused`、`completed`、`error`）。  
     `currentSegment`：正在写入的分段文件路径。  
     `error`：错误详情（如输入流中断、存储写入失败）。  